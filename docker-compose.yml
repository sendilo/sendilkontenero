version: '2'
services:
  haproxy:
    image: haproxy:alpine
    hostname: haproxy
    ports:
      - "80:80"
      - "443:443"
    volumes_from:
      - haproxy-syslog
    volumes:
      - ./config/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg:ro
  haproxy-syslog:
    image: outstand/syslog-ng-stdout:latest
  http:
    image: nginx:alpine
    restart: always
    hostname: http
    expose:
    - "80"
    volumes:
    - ./letsencrypt/http:/usr/share/nginx/html:ro
  sendilo:
    build: .
    restart: always
    hostname: sendilo
    ports:
    - "443"
    volumes:
    - ./letsencrypt/etc:/solid/certs:ro
    - ./config/config.json:/solid/run/config.json:ro
    - ./solid/config:/solid/config
    - ./solid/data:/solid/data
    - ./solid/db:/solid/db
    environment:
    - DEBUG=solid:*,sendilo:*
    - NODE_TLS_REJECT_UNAUTHORIZED=0
    command: ["/solid/run/bin/sendilo", "start", "--verbose" ]
